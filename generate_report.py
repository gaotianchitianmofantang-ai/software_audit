import sys
import json
from datetime import datetime

if len(sys.argv) < 3:
    print("ä½¿ã„æ–¹: python3 generate_report.py [å…¥åŠ›JSON] [å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«]", file=sys.stderr)
    sys.exit(1)

input_json = sys.argv[1]
output_file = sys.argv[2]

with open(input_json, 'r', encoding='utf-8') as f:
    info = json.load(f)

software_name = info.get('ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å', '')
is_paid = info.get('æœ‰å„Ÿç„¡å„Ÿ', '')
reference_url = info.get('å‚è€ƒURL', '')

report = f"""# ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯©æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

**ç”Ÿæˆæ—¥æ™‚**: {datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')}  
**å¯©æŸ»å¯¾è±¡**: {software_name}  
**æœ‰å„Ÿ/ç„¡å„Ÿ**: {is_paid}

---

## ðŸ“‹ ç”³è«‹æƒ…å ±

"""

for key, value in info.items():
    if value:
        report += f"- **{key}**: {value}\n"

report += """

---

## ðŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯©æŸ»é …ç›®

### âœ… ãƒã‚§ãƒƒã‚¯1: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£äº‹æ•…å ±å‘Š

**æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**: ã€Œ{software_name} ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã€ã€Œ{software_name} æƒ…å ±æ¼æ´©ã€

**ç¢ºèªæ–¹æ³•**: 
1. JVN iPedia (https://jvndb.jvn.jp/) ã§ã®æ¤œç´¢
2. ä¸€èˆ¬æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§ã®éŽåŽ»1å¹´é–“ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹æ¤œç´¢

**å¯©æŸ»çµæžœ**: [ ] å•é¡Œãªã— / [ ] è¦æ³¨æ„ / [ ] å´ä¸‹æŽ¨å¥¨

**ã‚³ãƒ¡ãƒ³ãƒˆ**:  
- 

### âœ… ãƒã‚§ãƒƒã‚¯2: ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆé »åº¦ãƒ»ã‚µãƒãƒ¼ãƒˆçŠ¶æ³

""".format(software_name=software_name)

if "æœ‰å„Ÿ" in is_paid:
    report += """**å¯¾è±¡**: æœ‰å„Ÿã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢

**ç¢ºèªå†…å®¹**: 
- JVN iPedia (https://jvndb.jvn.jp/) ã§ã®éŽåŽ»5å¹´é–“ã®è„†å¼±æ€§å ±å‘Šç¢ºèª

**JVN iPediaæ¤œç´¢çµæžœ**: 
æ¤œç´¢URL: https://jvndb.jvn.jp/search/index.php?mode=_vulnerability_search_IA_VulnSearch&keyword={software_name}

**éŽåŽ»5å¹´ã®è„†å¼±æ€§å ±å‘Šä»¶æ•°**: [ ] 0ä»¶ / [ ] ___ ä»¶

""".format(software_name=software_name)
else:
    report += """**å¯¾è±¡**: ç„¡å„Ÿã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢

**ç¢ºèªå†…å®¹**: 
- æœ€çµ‚æ›´æ–°æ—¥ãŒ1å¹´ä»¥å†…ã§ã‚ã‚‹ã“ã¨
- å…¬å¼ã‚µã‚¤ãƒˆã¾ãŸã¯GitHubã§ã®ãƒªãƒªãƒ¼ã‚¹å±¥æ­´ç¢ºèª

**æœ€çµ‚æ›´æ–°æ—¥**: 
**æ›´æ–°é »åº¦**: [ ] é »ç¹ / [ ] å®šæœŸçš„ / [ ] ä¸å®šæœŸ / [ ] æ›´æ–°åœæ­¢

"""

report += """**å¯©æŸ»çµæžœ**: [ ] å•é¡Œãªã— / [ ] è¦æ³¨æ„ / [ ] å´ä¸‹æŽ¨å¥¨

**ã‚³ãƒ¡ãƒ³ãƒˆ**:  
- 

### âœ… ãƒã‚§ãƒƒã‚¯3: ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢æä¾›å…ƒã®è©•åˆ¤

**æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**: ã€Œ{software_name} è©•åˆ¤ã€ã€Œ{software_name} ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€

**ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: 
- æä¾›å…ƒä¼æ¥­/çµ„ç¹”ã®ä¿¡é ¼æ€§
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹ãƒã‚¬ãƒ†ã‚£ãƒ–ãªè©•ä¾¡ã®æœ‰ç„¡

**å¯©æŸ»çµæžœ**: [ ] å•é¡Œãªã— / [ ] è¦æ³¨æ„ / [ ] å´ä¸‹æŽ¨å¥¨

**ã‚³ãƒ¡ãƒ³ãƒˆ**:  
- 

### âœ… ãƒã‚§ãƒƒã‚¯4: ãƒ‡ãƒ¼ã‚¿å…±æœ‰æ©Ÿèƒ½ã®æœ‰ç„¡

**ç¢ºèªå†…å®¹**: 
- ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰æ©Ÿèƒ½ã®æœ‰ç„¡
- ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸæ©Ÿèƒ½ã®æœ‰ç„¡
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®æœ‰ç„¡

**å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§**: {reference_url}

**ãƒ‡ãƒ¼ã‚¿å…±æœ‰æ©Ÿèƒ½**: [ ] ãªã— / [ ] ã‚ã‚Šï¼ˆè©³ç´°: _________ï¼‰

**å¯©æŸ»çµæžœ**: [ ] å•é¡Œãªã— / [ ] è¦æ³¨æ„ / [ ] å´ä¸‹æŽ¨å¥¨

**ã‚³ãƒ¡ãƒ³ãƒˆ**:  
- 

---

## ðŸ“Š ç·åˆåˆ¤å®š

**æœ€çµ‚åˆ¤å®š**: [ ] æ‰¿èª / [ ] æ¡ä»¶ä»˜ãæ‰¿èª / [ ] å´ä¸‹

**å¯©æŸ»è€…**: __________________
**å¯©æŸ»æ—¥**: __________________

**ç·åˆã‚³ãƒ¡ãƒ³ãƒˆ**:  


""".format(software_name=software_name, reference_url=reference_url)

with open(output_file, 'w', encoding='utf-8') as f:
    f.write(report)

print(f"ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ: {output_file}")
